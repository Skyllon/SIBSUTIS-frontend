<div class="list-container">
  <!-- Панель фильтров -->
  <section class="filter-panel">
    <form [formGroup]="filterForm" class="filter-form">
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Поиск</mat-label>
        <input matInput formControlName="search" placeholder="Название или описание" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Тип</mat-label>
        <mat-select formControlName="type">
          <mat-option *ngFor="let t of issueTypes" [value]="t">{{ t }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Приоритет</mat-label>
        <mat-select formControlName="priority">
          <mat-option *ngFor="let p of priorities" [value]="p">{{ p }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Статус</mat-label>
        <mat-select formControlName="status">
          <mat-option *ngFor="let s of statuses" [value]="s">{{ s }}</mat-option>
        </mat-select>
      </mat-form-field>
    </form>

    <button mat-raised-button color="primary" (click)="addIssue()">
      <mat-icon>add</mat-icon>
      Новая задача
    </button>
  </section>

  <!-- Таблица задач -->
  <section class="table-container">
    <div *ngIf="isLoading" class="loading">
      Загрузка задач...
    </div>

    <table
      mat-table
      [dataSource]="dataSource"
      class="mat-elevation-z2"
      *ngIf="!isLoading">

      <!-- Столбец ID -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef>#</th>
        <td mat-cell *matCellDef="let issue">{{ issue.id }}</td>
      </ng-container>

      <!-- Столбец Название -->
      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef>Название</th>
        <td mat-cell *matCellDef="let issue">
          <a style="cursor: pointer; text-decoration: underline;" (click)="openIssue(issue)">
            {{ issue.title }}
          </a>
        </td>
      </ng-container>

      <!-- Столбец Тип -->
      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef>Тип</th>
        <td mat-cell *matCellDef="let issue">{{ issue.type }}</td>
      </ng-container>

      <!-- Столбец Приоритет -->
      <ng-container matColumnDef="priority">
        <th mat-header-cell *matHeaderCellDef>Приоритет</th>
        <td mat-cell *matCellDef="let issue">
          <mat-chip
            [color]="issue.priority === 'Critical' ? 'warn' : 'primary'"
            selected>
            {{ issue.priority }}
          </mat-chip>
        </td>
      </ng-container>

      <!-- Столбец Исполнитель -->
      <ng-container matColumnDef="assignee">
        <th mat-header-cell *matHeaderCellDef>Исполнитель</th>
        <td mat-cell *matCellDef="let issue">{{ issue.assignee || '—' }}</td>
      </ng-container>

      <!-- Столбец Статус -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Статус</th>
        <td mat-cell *matCellDef="let issue">{{ issue.status }}</td>
      </ng-container>

      <!-- Столбец Действия -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Действия</th>
        <td mat-cell *matCellDef="let issue">
          <button mat-icon-button color="primary" (click)="openIssue(issue)">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn" (click)="deleteIssue(issue)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <!-- Заголовок таблицы -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

      <!-- Строки таблицы -->
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      <!-- Строка "нет данных" -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" [attr.colspan]="displayedColumns.length">
          Задачи не найдены
        </td>
      </tr>
    </table>
  </section>
</div>
